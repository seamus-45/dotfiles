#!/bin/bash
DEFAULT="TRUE\nnew\nnew tmux session\n"
SESSIONS=$(tmux list-sessions | sed 's@\([a-zA-Z]\+\):.*(\(created.*\))\s.*@FALSE\\n\1\\n\2\\n@' | tr -d '\n')
LIST="${DEFAULT}${SESSIONS}"
SELECT=$(\
echo -ne $LIST |\
zenity --title 'tmux session manager'\
  --list --radiolist --text 'select session:'\
  --separator='\n' \
  --column='' --column='session' --column='timestamp' \
  --print-column=2 --width=350 --height=250 \
)

if [ -n "$SELECT" ]; then
  case "$SELECT" in
    new)
      SELECT=$(zenity --title 'new tmux session' --entry --text='name:' --entry-text='untitled')
      if [ -n "${SELECT}" ]; then
        if [[ ! $( echo $SESSIONS | grep ${SELECT} ) ]]; then
          tmux new-session -s ${SELECT}
        else
          tmux attach-session -t ${SELECT}
        fi
      fi
      ;;
    *)
      tmux attach-session -t ${SELECT}
      ;;
  esac
fi
